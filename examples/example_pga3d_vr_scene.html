<HEAD>
  <META name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <SCRIPT SRC="../ganja.js"></SCRIPT>
  <STYLE>
    body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px 15px;
      border-radius: 4px;
      font-size: 14px;
      z-index: 1001;
      max-width: 300px;
    }
  </STYLE>
</HEAD>
<BODY>
<DIV id="info">
  <strong>Virtual Reality 3D Scene</strong><br>
  Explore geometric algebra objects in immersive VR.
  <br><br>
  <small>Requires a WebXR-compatible browser and VR headset.</small>
</DIV>
<SCRIPT>
// Create a Clifford Algebra with 3,0,1 metric for 3D PGA
Algebra(3,0,1,()=>{
  
  // Define basic geometric primitives in PGA
  var point = (x,y,z)=>!(1e0 + x*1e1 + y*1e2 + z*1e3);
  var line = (...plucker)=>plucker*[1e01,1e02,1e03,1e12,1e13,1e23];
  var plane = (a,b,c,d)=>a*1e1 + b*1e2 + c*1e3 + d*1e0;
  
  // Animation state
  var time = 0;
  
  // Scene generation function
  var generateScene = () => {
    time += 0.01;
    
    // Create animated rotating objects
    var angle = time;
    var radius = 1.5;
    
    // Create points in a rotating pattern
    var points = [];
    
    for (var i = 0; i < 5; i++) {
      var a = angle + (i * Math.PI * 2 / 5);
      var x = Math.cos(a) * radius;
      var z = Math.sin(a) * radius;
      var y = Math.sin(time * 2 + i) * 0.5;
      
      points.push(point(x, y, z));
    }
    
    // Create geometric shapes
    var scene = [];
    
    // Add a grid plane at ground level
    scene.push(0x444444);
    scene.push(plane(0, 1, 0, 1));
    
    // Add rotating points and connections
    scene.push(0x00AAFF);
    for (var i = 0; i < points.length; i++) {
      scene.push(points[i]);
      scene.push([points[i], points[(i+1) % points.length]]);
      scene.push([points[i], points[(i+2) % points.length]]);
    }
    
    // Add a central geometric structure
    var centerPoints = [
      point(0, 0.8, 0),
      point(0.5, -0.5, -0.5),
      point(-0.5, -0.5, -0.5),
      point(0.5, -0.5, 0.5),
      point(-0.5, -0.5, 0.5)
    ];
    
    scene.push(0xFF8844);
    scene.push([centerPoints[0], centerPoints[1]]);
    scene.push([centerPoints[0], centerPoints[2]]);
    scene.push([centerPoints[0], centerPoints[3]]);
    scene.push([centerPoints[0], centerPoints[4]]);
    scene.push([centerPoints[1], centerPoints[2]]);
    scene.push([centerPoints[2], centerPoints[4]]);
    scene.push([centerPoints[4], centerPoints[3]]);
    scene.push([centerPoints[3], centerPoints[1]]);
    
    // Add labels
    scene.push(0xFFFFFF);
    scene.push(centerPoints[0]);
    scene.push("Apex");
    
    // Add some floating text
    scene.push(0x88FF88);
    scene.push(point(0, 2, -2));
    scene.push("3D PGA in VR");
    
    return scene;
  };
  
  // Check if WebXR is available
  if (!navigator.xr) {
    document.getElementById('info').innerHTML = 
      '<strong>WebXR Not Supported</strong><br>' +
      'Your browser does not support WebXR. Please use a compatible browser.';
    
    // Fallback: Show regular animated 3D scene
    document.body.appendChild(this.graph(generateScene, {
      gl: true,
      animate: true,
      grid: true,
      labels: true,
      h: 0.6,
      p: -0.15,
      lineWidth: 3,
      pointRadius: 1.5,
      fontSize: 1,
      scale: 1,
    }));
  } else {
    // Use WebXR VR mode
    document.body.appendChild(this.graphXR(generateScene, {
      xr: 'vr',
      animate: true,
      lineWidth: 3,
      pointRadius: 2,
      fontSize: 1.5,
    }));
  }
});
</SCRIPT>
</BODY>
